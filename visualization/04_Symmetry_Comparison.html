<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ®µéšçš„é›¶ç‚¹æ¢ç´¢ - å®Ÿç”¨ç‰ˆ</title>
<style>
body {
    margin: 0;
    padding: 20px;
    background: #000;
    color: #fff;
    font-family: monospace;
}
.container {
    max-width: 1400px;
    margin: 0 auto;
}
h2 { color: #0f0; }
.section {
    background: #111;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}
.preset-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
button {
    padding: 12px 24px;
    background: #222;
    color: #0f0;
    border: 1px solid #0f0;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
}
button:hover { background: #0f0; color: #000; }
button.active { background: #0f0; color: #000; }
.result {
    background: #0a0a0a;
    padding: 15px;
    border-left: 3px solid #0f0;
    margin: 10px 0;
    border-radius: 4px;
}
.warning { border-color: #f80; color: #f80; }
.error { border-color: #f00; color: #f00; }
.value { color: #0ff; font-weight: bold; }
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}
th, td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #333;
}
th { background: #0a0a0a; color: #0f0; }
.progress {
    width: 100%;
    height: 30px;
    background: #222;
    border-radius: 4px;
    overflow: hidden;
    margin: 10px 0;
}
.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #0a0, #0f0);
    transition: width 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    font-weight: bold;
}
</style>
</head>
<body>

<div class="container">
    <h2>ğŸ¯ æ®µéšçš„é›¶ç‚¹æ¢ç´¢ã‚·ã‚¹ãƒ†ãƒ </h2>
    
    <div class="section">
        <h3>ğŸ“‹ ãƒ—ãƒªã‚»ãƒƒãƒˆæ¢ç´¢</h3>
        <div class="preset-buttons">
            <button onclick="runPreset('coarse')">1ï¸âƒ£ ç²—æ¢ç´¢ (Â±10, dt=0.01)</button>
            <button onclick="runPreset('medium')">2ï¸âƒ£ ä¸­æ¢ç´¢ (Â±1, dt=0.001)</button>
            <button onclick="runPreset('fine')">3ï¸âƒ£ ç²¾å¯†æ¢ç´¢ (Â±0.1, dt=0.0001)</button>
            <button onclick="runPreset('ultra')">4ï¸âƒ£ è¶…ç²¾å¯† (Â±0.01, dt=0.00001)</button>
        </div>
        
        <div class="preset-buttons">
            <button onclick="scanWalls()" style="border-color:#08f; color:#08f;">ğŸ§± å£ã‚¹ã‚­ãƒ£ãƒ³ (Ïƒ=0.49-0.51)</button>
            <button onclick="exportResults()" style="border-color:#f80; color:#f80;">ğŸ’¾ çµæœã‚’JSONå‡ºåŠ›</button>
        </div>
    </div>
    
    <div class="section" id="status">
        <h3>â³ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
        <p>ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¢ç´¢ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
    </div>
    
    <div class="section" id="results" style="display:none;">
        <h3>ğŸ“Š çµæœ</h3>
        <div id="resultsContent"></div>
    </div>
</div>

<script>
// Î¶é–¢æ•°è¨ˆç®—
function zeta(sigma, t, N = 5000) {
    let eta_re = 0, eta_im = 0;
    
    for (let n = 1; n <= N; n++) {
        const sign = (n % 2 === 1) ? 1 : -1;
        const logn = Math.log(n);
        const mag = Math.exp(-sigma * logn);
        const arg = -t * logn;
        eta_re += sign * mag * Math.cos(arg);
        eta_im += sign * mag * Math.sin(arg);
    }
    
    const log2 = Math.log(2);
    const exp_r = Math.exp((1 - sigma) * log2);
    const exp_arg = -t * log2;
    const d_re = 1 - exp_r * Math.cos(exp_arg);
    const d_im = -exp_r * Math.sin(exp_arg);
    const d2 = d_re * d_re + d_im * d_im + 1e-300;
    
    const re = (eta_re * d_re + eta_im * d_im) / d2;
    const im = (eta_im * d_re - eta_re * d_im) / d2;
    
    return { 
        re, 
        im, 
        abs: Math.sqrt(re*re + im*im)
    };
}

let allResults = {};

async function search(sigma, tCenter, tRange, dt, N = 5000) {
    const data = [];
    let minAbs = Infinity;
    let minPoint = null;
    
    const steps = Math.floor((2 * tRange) / dt);
    
    for (let i = 0; i <= steps; i++) {
        const t = tCenter - tRange + i * dt;
        const z = zeta(sigma, t, N);
        
        if (z.abs < minAbs) {
            minAbs = z.abs;
            minPoint = { t, ...z };
        }
        
        // é€²æ—è¡¨ç¤º
        if (i % 100 === 0) {
            updateProgress(i, steps);
            await new Promise(resolve => setTimeout(resolve, 0)); // UIæ›´æ–°
        }
    }
    
    return { minPoint, totalPoints: steps + 1 };
}

function updateProgress(current, total) {
    const percent = (current / total * 100).toFixed(1);
    const statusDiv = document.getElementById('status');
    statusDiv.innerHTML = `
        <h3>â³ è¨ˆç®—ä¸­...</h3>
        <div class="progress">
            <div class="progress-bar" style="width:${percent}%">${percent}%</div>
        </div>
        <p>${current.toLocaleString()} / ${total.toLocaleString()} ç‚¹</p>
    `;
}

async function runPreset(type) {
    const presets = {
        'coarse': { 
            tCenter: 14.134725, 
            tRange: 10, 
            dt: 0.01, 
            N: 3000,
            name: 'ç²—æ¢ç´¢'
        },
        'medium': { 
            tCenter: 14.134725, 
            tRange: 1, 
            dt: 0.001, 
            N: 5000,
            name: 'ä¸­æ¢ç´¢'
        },
        'fine': { 
            tCenter: 14.134725, 
            tRange: 0.1, 
            dt: 0.0001, 
            N: 8000,
            name: 'ç²¾å¯†æ¢ç´¢'
        },
        'ultra': { 
            tCenter: 14.134725, 
            tRange: 0.01, 
            dt: 0.00001, 
            N: 10000,
            name: 'è¶…ç²¾å¯†æ¢ç´¢'
        }
    };
    
    const config = presets[type];
    const sigma = 0.5;
    
    document.getElementById('status').innerHTML = `
        <h3>ğŸ” ${config.name}ã‚’é–‹å§‹</h3>
        <p>Ïƒ = ${sigma}</p>
        <p>tä¸­å¿ƒ = ${config.tCenter}</p>
        <p>tç¯„å›² = Â±${config.tRange}</p>
        <p>åˆ»ã¿ = ${config.dt}</p>
        <p>é …æ•° = ${config.N}</p>
    `;
    
    const result = await search(sigma, config.tCenter, config.tRange, config.dt, config.N);
    
    allResults[type] = {
        config,
        result: result.minPoint,
        totalPoints: result.totalPoints
    };
    
    displayResult(type, config, result);
}

function displayResult(type, config, result) {
    document.getElementById('results').style.display = 'block';
    const content = document.getElementById('resultsContent');
    
    const isZero = result.minPoint.abs < 1e-6;
    const isNear = result.minPoint.abs < 1e-3;
    
    let html = `
        <div class="result ${isZero ? '' : isNear ? 'warning' : 'error'}">
            <h4>âœ… ${config.name}å®Œäº†</h4>
            <table>
                <tr><th>é …ç›®</th><th>å€¤</th></tr>
                <tr><td>è¨ˆç®—ç‚¹æ•°</td><td>${result.totalPoints.toLocaleString()}</td></tr>
                <tr><td>tä½ç½®</td><td class="value">${result.minPoint.t.toFixed(12)}</td></tr>
                <tr><td>|Î¶(0.5+it)|</td><td class="value">${result.minPoint.abs.toExponential(10)}</td></tr>
                <tr><td>Re(Î¶)</td><td class="value">${result.minPoint.re.toExponential(10)}</td></tr>
                <tr><td>Im(Î¶)</td><td class="value">${result.minPoint.im.toExponential(10)}</td></tr>
            </table>
    `;
    
    if (isZero) {
        html += `<p style="color:#0f0; font-size:18px; margin-top:10px;">ğŸ¯ é›¶ç‚¹ã‚’ç™ºè¦‹ï¼ |Î¶| < 10â»â¶</p>`;
    } else if (isNear) {
        html += `<p style="color:#f80; margin-top:10px;">âš ï¸ é›¶ç‚¹ã«è¿‘ã„ã€‚ã‚ˆã‚Šç²¾å¯†ãªæ¢ç´¢ã‚’æ¨å¥¨ã€‚</p>`;
    } else {
        html += `<p style="color:#f00; margin-top:10px;">âŒ ã“ã®ç¯„å›²ã«é›¶ç‚¹ãªã—ã€‚tä¸­å¿ƒã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>`;
    }
    
    // æ¨å¥¨æ¬¡ã‚¹ãƒ†ãƒƒãƒ—
    if (!isZero && isNear) {
        html += `
            <p style="color:#0ff; margin-top:10px;">
            ğŸ’¡ æ¨å¥¨: tä¸­å¿ƒã‚’ ${result.minPoint.t.toFixed(6)} ã«è¨­å®šã—ã¦ã€
            ã‚ˆã‚Šç²¾å¯†ãªæ¢ç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            </p>
        `;
    }
    
    html += `</div>`;
    
    content.innerHTML = html + content.innerHTML; // æ–°ã—ã„çµæœã‚’ä¸Šã«è¿½åŠ 
    
    document.getElementById('status').innerHTML = `
        <h3>âœ… å®Œäº†</h3>
        <p>æ¬¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
    `;
}

async function scanWalls() {
    const sigmas = [0.49, 0.495, 0.499, 0.5, 0.501, 0.505, 0.51];
    const tCenter = 14.134725;
    const tRange = 0.5;
    const dt = 0.001;
    const N = 5000;
    
    const results = [];
    
    document.getElementById('status').innerHTML = `
        <h3>ğŸ§± å£ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</h3>
        <p>7å€‹ã®Ïƒå€¤ã§æ¢ç´¢ä¸­</p>
    `;
    
    for (let i = 0; i < sigmas.length; i++) {
        const sigma = sigmas[i];
        updateProgress(i, sigmas.length);
        
        const result = await search(sigma, tCenter, tRange, dt, N);
        results.push({
            sigma,
            min_distance: result.minPoint.abs,
            t_at_min: result.minPoint.t,
            re_at_min: result.minPoint.re,
            im_at_min: result.minPoint.im
        });
        
        await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    allResults['wall_scan'] = results;
    
    displayWallResults(results);
}

function displayWallResults(results) {
    document.getElementById('results').style.display = 'block';
    const content = document.getElementById('resultsContent');
    
    let html = `
        <div class="result">
            <h4>ğŸ§± å£ã‚¹ã‚­ãƒ£ãƒ³çµæœ</h4>
            <table>
                <tr><th>Ïƒ</th><th>æœ€å°è·é›¢</th><th>tä½ç½®</th><th>è©•ä¾¡</th></tr>
    `;
    
    for (const r of results) {
        const isZero = r.min_distance < 1e-6;
        const isWall = r.min_distance > 0.001;
        const status = isZero ? 'ğŸ¯ é›¶ç‚¹' : isWall ? 'ğŸ§± å£' : 'âš ï¸ å¼±';
        const color = isZero ? '#0f0' : isWall ? '#f00' : '#f80';
        
        html += `
            <tr>
                <td>${r.sigma.toFixed(3)}</td>
                <td style="color:${color};">${r.min_distance.toExponential(4)}</td>
                <td>${r.t_at_min.toFixed(8)}</td>
                <td>${status}</td>
            </tr>
        `;
    }
    
    html += `</table>`;
    
    // Leanç”¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
    const sigma049 = results.find(r => Math.abs(r.sigma - 0.49) < 0.01);
    const sigma051 = results.find(r => Math.abs(r.sigma - 0.51) < 0.01);
    const sigma050 = results.find(r => Math.abs(r.sigma - 0.5) < 0.01);
    
    html += `
        <h4 style="margin-top:20px;">ğŸ“ Lean 4 ã‚³ãƒ¼ãƒ‰</h4>
        <pre style="background:#0a0a0a; padding:15px; border-radius:4px; overflow-x:auto; color:#0f0;">
axiom wall_sigma_051 : âˆ€ t : â„, â€–Î¶ âŸ¨0.51, tâŸ©â€– â‰¥ ${sigma051.min_distance.toFixed(10)}
axiom wall_sigma_049 : âˆ€ t : â„, â€–Î¶ âŸ¨0.49, tâŸ©â€– â‰¥ ${sigma049.min_distance.toFixed(10)}

theorem critical_line_contains_zero :
  âˆƒ t : â„, Î¶ âŸ¨1/2, tâŸ© = 0 := by
  use ${sigma050.t_at_min.toFixed(12)}
  -- |Î¶| = ${sigma050.min_distance.toExponential(6)}
  sorry</pre>
    `;
    
    html += `</div>`;
    
    content.innerHTML = html + content.innerHTML;
    
    document.getElementById('status').innerHTML = `
        <h3>âœ… å£ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†</h3>
        <p>çµæœã‚’ç¢ºèªã—ã¦ã€JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„</p>
    `;
}

function exportResults() {
    if (Object.keys(allResults).length === 0) {
        alert('ã¾ãšæ¢ç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
        return;
    }
    
    const json = JSON.stringify(allResults, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'riemann_zero_search_results.json';
    a.click();
    
    alert('çµæœã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ');
}

// åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
document.getElementById('status').innerHTML = `
    <h3>ğŸ’¡ ä½¿ã„æ–¹</h3>
    <ol style="line-height:1.8;">
        <li><strong>1ï¸âƒ£ ç²—æ¢ç´¢</strong>ã‹ã‚‰é †ç•ªã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æ¨å¥¨</li>
        <li>å„ã‚¹ãƒ†ãƒƒãƒ—ã§é›¶ç‚¹ã®å¤§ã¾ã‹ãªä½ç½®ã‚’çµã‚Šè¾¼ã‚€</li>
        <li>æœ€çµ‚çš„ã«<strong>4ï¸âƒ£ è¶…ç²¾å¯†</strong>ã§æ­£ç¢ºãªå€¤ã‚’å¾—ã‚‹</li>
        <li><strong>ğŸ§± å£ã‚¹ã‚­ãƒ£ãƒ³</strong>ã§Ïƒâ‰ 0.5ã§ã®ä¸‹é™ã‚’ç¢ºèª</li>
        <li><strong>ğŸ’¾ çµæœã‚’JSONå‡ºåŠ›</strong>ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</li>
    </ol>
    <p style="color:#0ff; margin-top:15px;">
    âš¡ ãƒ’ãƒ³ãƒˆ: å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è¦‹ã¤ã‘ãŸtä½ç½®ã‚’ä½¿ã£ã¦ã€
    HTMLã® tCenter å€¤ã‚’æ›¸ãæ›ãˆã‚‹ã¨ã€ã‚ˆã‚Šæ­£ç¢ºã«æ¢ç´¢ã§ãã¾ã™ã€‚
    </p>
`;
</script>

</body>
</html>
